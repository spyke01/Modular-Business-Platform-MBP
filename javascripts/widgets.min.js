require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({2:[function(require,module,exports){
"use strict";

var mbpWidgets = {
  init: function init() {
    var rem,
        widgetAreas = $('div.widgets-sortables');
    $('#widgets-rightCol').children('.ui-widget').children('.header').click(function () {
      mbpWidgets.collapse(this);
    });
    $('#widgets-rightCol').children('.box').children('.box-header').click(function () {
      mbpWidgets.collapse(this);
    });
    $('#available-widgets').children('.box-header').click(function () {
      mbpWidgets.collapse(this);
    });
    $(document).on('click', 'a.widget-action', function () {
      var css = {},
          widget = $(this).closest('div.widget'),
          inside = widget.children('.widget-inside');

      if (inside.is(':hidden')) {
        inside.slideDown('fast');
      } else {
        inside.slideUp('fast');
      }

      return false;
    });
    $(document).on('click', 'input.widget-control-save', function () {
      mbpWidgets.save($(this).closest('div.widget'), 0, 1, 0);
      return false;
    });
    $(document).on('click', 'a.widget-control-remove', function () {
      mbpWidgets.save($(this).closest('div.widget'), 1, 1, 0);
      return false;
    });
    $(document).on('click', 'a.widget-control-close', function () {
      mbpWidgets.close($(this).closest('div.widget'));
      return false;
    });
    widgetAreas.children('.widget').each(function () {
      if ($('p.widget-error', this).length) {
        $('a.widget-action', this).click();
      }
    });
    $('#widget-list').children('.widget').draggable({
      connectToSortable: 'div.widgets-sortables',
      handle: '> .widget-top > .widget-title',
      distance: 2,
      helper: 'clone',
      zIndex: 5,
      containment: 'document',
      start: function start(e, ui) {
        ui.helper.find('div.widget-description').hide();
      },
      stop: function stop(e, ui) {
        if (rem) {
          $(rem).hide();
        }

        rem = '';
      }
    });
    widgetAreas.sortable({
      placeholder: 'widget-placeholder',
      items: '> .widget',
      handle: '> .widget-top > .widget-title',
      cursor: 'move',
      distance: 2,
      containment: 'document',
      start: function start(e, ui) {
        ui.item.children('.widget-inside').hide();
      },
      stop: function stop(e, ui) {
        if (ui.item.hasClass('ui-draggable') && ui.item.data('draggable')) {
          ui.item.draggable('destroy');
        }

        if (ui.item.hasClass('deleting')) {
          mbpWidgets.save(ui.item, 1, 0, 1); // delete widget

          ui.item.remove();
          return;
        }

        var add = ui.item.find('input.create').val(),
            n = ui.item.find('input.instance_number').val(),
            id = ui.item.find('input.widget-id').val(),
            sb = $(this).attr('id');

        if (add) {
          ui.item.html(ui.item.html().replace(/<[^<>]+>/g, function (m) {
            return m.replace(/__i__|%i%/g, n);
          }));
          ui.item.attr('id', ui.item.find('input.widget-id').val()); // The id doesn't changed so pull the proper value from the hidden field

          n++;
          $('div#widget-' + id).find('input.instance_number').val(n); // This will set our next instance value

          mbpWidgets.save(ui.item, 0, 0, 1);
          ui.item.find('input.create').val('');
          ui.item.find('a.widget-action').click();
          return;
        }

        mbpWidgets.saveOrder(sb);
      },
      receive: function receive(e, ui) {
        if (!$(this).is(':visible')) {
          $(this).sortable('cancel');
        }
      }
    }).sortable('option', 'connectWith', 'div.widgets-sortables').parent().filter('.closed').children('.widgets-sortables').sortable('disable');
    $('#available-widgets').droppable({
      tolerance: 'pointer',
      accept: function accept(o) {
        return $(o).parent().attr('id') != 'widget-list';
      },
      drop: function drop(e, ui) {
        ui.draggable.addClass('deleting');
        $('#removing-widget').hide().children('span').html('');
      },
      over: function over(e, ui) {
        ui.draggable.addClass('deleting');
        $('div.widget-placeholder').hide();

        if (ui.draggable.hasClass('ui-sortable-helper')) {
          $('#removing-widget').show().children('span').html(ui.draggable.find('div.widget-title').children('h4').html());
        }
      },
      out: function out(e, ui) {
        ui.draggable.removeClass('deleting');
        $('div.widget-placeholder').show();
        $('#removing-widget').hide().children('span').html('');
      }
    });
  },
  saveOrder: function saveOrder(sb) {
    if (sb) {
      $('#' + sb).closest('div.widgets-holder-wrap').find('img.ajax-feedback').css('visibility', 'visible');
    }

    var a = {
      action: 'widgets-order',
      widgetAreas: []
    };
    $('div.widgets-sortables').each(function () {
      a['widgetAreas[' + $(this).attr('id') + ']'] = $(this).sortable('toArray').join(',');
    });
    $.post(SITE_URL + '/ajax.php', a, function () {
      $('.ajax-feedback img').css('visibility', 'hidden');
    });
  },
  save: function save(widget, del, animate, order) {
    var sb = widget.closest('div.widgets-sortables').attr('id'),
        data = widget.find('form').serialize(),
        a;
    widget = $(widget);
    $('.ajax-feedback img', widget).css('visibility', 'visible');
    $('.ajax-feedback span', widget).html('');
    a = {
      action: 'save-widget',
      area: sb
    };

    if (del) {
      a['delete_widget'] = 1;
    }

    data += '&' + $.param(a);
    $.post(SITE_URL + '/ajax.php', data, function (r) {
      var id;

      if (del) {
        if (animate) {
          order = 0;
          widget.slideUp('fast', function () {
            $(this).remove();
            mbpWidgets.saveOrder();
          });
        } else {
          widget.remove();
        }
      } else {
        $('.ajax-feedback img').css('visibility', 'hidden');

        if (r && r.length > 2) {
          $('.ajax-feedback span', widget).html(r);
        }
      }

      if (order) {
        mbpWidgets.saveOrder();
      }
    });
  },
  close: function close(widget) {
    widget.children('.widget-inside').slideUp('fast');
  },
  collapse: function collapse(itemToCollapse) {
    var c = $(itemToCollapse).siblings('.widgets-sortables'),
        p = $(itemToCollapse).parent();

    if (!p.hasClass('closed')) {
      c.sortable('disable');
      p.addClass('closed');
    } else {
      p.removeClass('closed');
      c.sortable('enable').sortable('refresh');
    }
  }
};

},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9mYWN0b3ItYnVuZGxlL25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqYXZhc2NyaXB0cy93aWRnZXRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLFVBQVUsR0FBRztBQUNmLEVBQUEsSUFBSSxFQUFFLGdCQUFXO0FBQ2YsUUFBSSxHQUFKO0FBQUEsUUFBUyxXQUFXLEdBQUcsQ0FBQyxDQUFDLHVCQUFELENBQXhCO0FBRUEsSUFBQSxDQUFDLENBQUMsbUJBQUQsQ0FBRCxDQUF1QixRQUF2QixDQUFnQyxZQUFoQyxFQUE4QyxRQUE5QyxDQUF1RCxTQUF2RCxFQUFrRSxLQUFsRSxDQUF3RSxZQUFXO0FBQ2pGLE1BQUEsVUFBVSxDQUFDLFFBQVgsQ0FBb0IsSUFBcEI7QUFDRCxLQUZEO0FBSUEsSUFBQSxDQUFDLENBQUMsbUJBQUQsQ0FBRCxDQUF1QixRQUF2QixDQUFnQyxNQUFoQyxFQUF3QyxRQUF4QyxDQUFpRCxhQUFqRCxFQUFnRSxLQUFoRSxDQUFzRSxZQUFXO0FBQy9FLE1BQUEsVUFBVSxDQUFDLFFBQVgsQ0FBb0IsSUFBcEI7QUFDRCxLQUZEO0FBSUEsSUFBQSxDQUFDLENBQUMsb0JBQUQsQ0FBRCxDQUF3QixRQUF4QixDQUFpQyxhQUFqQyxFQUFnRCxLQUFoRCxDQUFzRCxZQUFXO0FBQy9ELE1BQUEsVUFBVSxDQUFDLFFBQVgsQ0FBb0IsSUFBcEI7QUFDRCxLQUZEO0FBSUEsSUFBQSxDQUFDLENBQUMsUUFBRCxDQUFELENBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IsaUJBQXhCLEVBQTJDLFlBQVc7QUFDcEQsVUFBSSxHQUFHLEdBQUcsRUFBVjtBQUFBLFVBQWMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUSxPQUFSLENBQWdCLFlBQWhCLENBQXZCO0FBQUEsVUFBc0QsTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFQLENBQWdCLGdCQUFoQixDQUEvRDs7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LHFCQUFELEVBQXdCLE1BQXhCLENBQUQsQ0FBaUMsSUFBakMsQ0FBc0MsQ0FBdEM7QUFDRDtBQUNGOztBQUNELFVBQUksS0FBSixFQUFXO0FBQ1QsUUFBQSxVQUFVLENBQUMsU0FBWDtBQUNEO0FBQ0YsS0F0QkQ7QUF1QkQsR0FyTWM7QUF1TWYsRUFBQSxLQUFLLEVBQUUsZUFBUyxNQUFULEVBQWlCO0FBQ3RCLElBQUEsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsZ0JBQWhCLEVBQWtDLE9BQWxDLENBQTBDLE1BQTFDO0FBQ0QsR0F6TWM7QUEyTWYsRUFBQSxRQUFRLEVBQUUsa0JBQVMsY0FBVCxFQUF5QjtBQUNqQyxRQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsY0FBRCxDQUFELENBQWtCLFFBQWxCLENBQTJCLG9CQUEzQixDQUFSO0FBQUEsUUFDRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLGNBQUQsQ0FBRCxDQUFrQixNQUFsQixFQUROOztBQUVBLFFBQUksQ0FBQyxDQUFDLENBQUMsUUFBRixDQUFXLFFBQVgsQ0FBTCxFQUEyQjtBQUN6QixNQUFBLENBQUMsQ0FBQyxRQUFGLENBQVcsU0FBWDtBQUNBLE1BQUEsQ0FBQyxDQUFDLFFBQUYsQ0FBVyxRQUFYO0FBQ0QsS0FIRCxNQUdPO0FBQ0wsTUFBQSxDQUFDLENBQUMsV0FBRixDQUFjLFFBQWQ7QUFDQSxNQUFBLENBQUMsQ0FBQyxRQUFGLENBQVcsUUFBWCxFQUFxQixRQUFyQixDQUE4QixTQUE5QjtBQUNEO0FBQ0Y7QUFyTmMsQ0FBakIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIG1icFdpZGdldHMgPSB7XG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciByZW0sIHdpZGdldEFyZWFzID0gJCgnZGl2LndpZGdldHMtc29ydGFibGVzJyk7XG5cbiAgICAkKCcjd2lkZ2V0cy1yaWdodENvbCcpLmNoaWxkcmVuKCcudWktd2lkZ2V0JykuY2hpbGRyZW4oJy5oZWFkZXInKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgIG1icFdpZGdldHMuY29sbGFwc2UodGhpcyk7XG4gICAgfSk7XG5cbiAgICAkKCcjd2lkZ2V0cy1yaWdodENvbCcpLmNoaWxkcmVuKCcuYm94JykuY2hpbGRyZW4oJy5ib3gtaGVhZGVyJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICBtYnBXaWRnZXRzLmNvbGxhcHNlKHRoaXMpO1xuICAgIH0pO1xuXG4gICAgJCgnI2F2YWlsYWJsZS13aWRnZXRzJykuY2hpbGRyZW4oJy5ib3gtaGVhZGVyJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICBtYnBXaWRnZXRzLmNvbGxhcHNlKHRoaXMpO1xuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ2Eud2lkZ2V0LWFjdGlvbicsIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGNzcyA9IHt9LCB3aWRnZXQgPSAkKHRoaXMpLmNsb3Nlc3QoJ2Rpdi53aWRnZXQnKSwgaW5zaWRlID0gd2lkZ2V0LmNoaWxkcmVuKCcud2lkZ2V0LWluc2lkZScpO1xuXG4gICAgICBpZiAoaW5zaWRlLmlzKCc6aGlkZGVuJykpIHtcbiAgICAgICAgaW5zaWRlLnNsaWRlRG93bignZmFzdCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5zaWRlLnNsaWRlVXAoJ2Zhc3QnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdpbnB1dC53aWRnZXQtY29udHJvbC1zYXZlJywgZnVuY3Rpb24oKSB7XG4gICAgICBtYnBXaWRnZXRzLnNhdmUoJCh0aGlzKS5jbG9zZXN0KCdkaXYud2lkZ2V0JyksIDAsIDEsIDApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ2Eud2lkZ2V0LWNvbnRyb2wtcmVtb3ZlJywgZnVuY3Rpb24oKSB7XG4gICAgICBtYnBXaWRnZXRzLnNhdmUoJCh0aGlzKS5jbG9zZXN0KCdkaXYud2lkZ2V0JyksIDEsIDEsIDApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ2Eud2lkZ2V0LWNvbnRyb2wtY2xvc2UnLCBmdW5jdGlvbigpIHtcbiAgICAgIG1icFdpZGdldHMuY2xvc2UoJCh0aGlzKS5jbG9zZXN0KCdkaXYud2lkZ2V0JykpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgd2lkZ2V0QXJlYXMuY2hpbGRyZW4oJy53aWRnZXQnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCQoJ3Aud2lkZ2V0LWVycm9yJywgdGhpcykubGVuZ3RoKSB7XG4gICAgICAgICQoJ2Eud2lkZ2V0LWFjdGlvbicsIHRoaXMpLmNsaWNrKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkKCcjd2lkZ2V0LWxpc3QnKS5jaGlsZHJlbignLndpZGdldCcpLmRyYWdnYWJsZSh7XG4gICAgICBjb25uZWN0VG9Tb3J0YWJsZTogJ2Rpdi53aWRnZXRzLXNvcnRhYmxlcycsXG4gICAgICBoYW5kbGU6ICc+IC53aWRnZXQtdG9wID4gLndpZGdldC10aXRsZScsXG4gICAgICBkaXN0YW5jZTogMixcbiAgICAgIGhlbHBlcjogJ2Nsb25lJyxcbiAgICAgIHpJbmRleDogNSxcbiAgICAgIGNvbnRhaW5tZW50OiAnZG9jdW1lbnQnLFxuICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIHVpLmhlbHBlci5maW5kKCdkaXYud2lkZ2V0LWRlc2NyaXB0aW9uJykuaGlkZSgpO1xuICAgICAgfSxcbiAgICAgIHN0b3A6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIGlmIChyZW0pIHtcbiAgICAgICAgICAkKHJlbSkuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJlbSA9ICcnO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHdpZGdldEFyZWFzLnNvcnRhYmxlKHtcbiAgICAgIHBsYWNlaG9sZGVyOiAnd2lkZ2V0LXBsYWNlaG9sZGVyJyxcbiAgICAgIGl0ZW1zOiAnPiAud2lkZ2V0JyxcbiAgICAgIGhhbmRsZTogJz4gLndpZGdldC10b3AgPiAud2lkZ2V0LXRpdGxlJyxcbiAgICAgIGN1cnNvcjogJ21vdmUnLFxuICAgICAgZGlzdGFuY2U6IDIsXG4gICAgICBjb250YWlubWVudDogJ2RvY3VtZW50JyxcbiAgICAgIHN0YXJ0OiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB1aS5pdGVtLmNoaWxkcmVuKCcud2lkZ2V0LWluc2lkZScpLmhpZGUoKTtcbiAgICAgIH0sXG4gICAgICBzdG9wOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICBpZiAodWkuaXRlbS5oYXNDbGFzcygndWktZHJhZ2dhYmxlJykgJiYgdWkuaXRlbS5kYXRhKCdkcmFnZ2FibGUnKSkge1xuICAgICAgICAgIHVpLml0ZW0uZHJhZ2dhYmxlKCdkZXN0cm95Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodWkuaXRlbS5oYXNDbGFzcygnZGVsZXRpbmcnKSkge1xuICAgICAgICAgIG1icFdpZGdldHMuc2F2ZSh1aS5pdGVtLCAxLCAwLCAxKTsgLy8gZGVsZXRlIHdpZGdldFxuICAgICAgICAgIHVpLml0ZW0ucmVtb3ZlKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGFkZCA9IHVpLml0ZW0uZmluZCgnaW5wdXQuY3JlYXRlJykudmFsKCksXG4gICAgICAgICAgbiA9IHVpLml0ZW0uZmluZCgnaW5wdXQuaW5zdGFuY2VfbnVtYmVyJykudmFsKCksXG4gICAgICAgICAgaWQgPSB1aS5pdGVtLmZpbmQoJ2lucHV0LndpZGdldC1pZCcpLnZhbCgpLFxuICAgICAgICAgIHNiID0gJCh0aGlzKS5hdHRyKCdpZCcpO1xuXG4gICAgICAgIGlmIChhZGQpIHtcbiAgICAgICAgICB1aS5pdGVtLmh0bWwodWkuaXRlbS5odG1sKCkucmVwbGFjZSgvPFtePD5dKz4vZywgZnVuY3Rpb24obSkgeyByZXR1cm4gbS5yZXBsYWNlKC9fX2lfX3wlaSUvZywgbik7IH0pKTtcbiAgICAgICAgICB1aS5pdGVtLmF0dHIoJ2lkJywgdWkuaXRlbS5maW5kKCdpbnB1dC53aWRnZXQtaWQnKS52YWwoKSk7IC8vIFRoZSBpZCBkb2Vzbid0IGNoYW5nZWQgc28gcHVsbCB0aGUgcHJvcGVyIHZhbHVlIGZyb20gdGhlIGhpZGRlbiBmaWVsZFxuICAgICAgICAgIG4rKztcbiAgICAgICAgICAkKCdkaXYjd2lkZ2V0LScgKyBpZCkuZmluZCgnaW5wdXQuaW5zdGFuY2VfbnVtYmVyJykudmFsKG4pOyAvLyBUaGlzIHdpbGwgc2V0IG91ciBuZXh0IGluc3RhbmNlIHZhbHVlXG5cbiAgICAgICAgICBtYnBXaWRnZXRzLnNhdmUodWkuaXRlbSwgMCwgMCwgMSk7XG4gICAgICAgICAgdWkuaXRlbS5maW5kKCdpbnB1dC5jcmVhdGUnKS52YWwoJycpO1xuICAgICAgICAgIHVpLml0ZW0uZmluZCgnYS53aWRnZXQtYWN0aW9uJykuY2xpY2soKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbWJwV2lkZ2V0cy5zYXZlT3JkZXIoc2IpO1xuICAgICAgfSxcbiAgICAgIHJlY2VpdmU6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIGlmICghJCh0aGlzKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICQodGhpcykuc29ydGFibGUoJ2NhbmNlbCcpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pLnNvcnRhYmxlKCdvcHRpb24nLCAnY29ubmVjdFdpdGgnLCAnZGl2LndpZGdldHMtc29ydGFibGVzJykucGFyZW50KCkuZmlsdGVyKCcuY2xvc2VkJykuY2hpbGRyZW4oJy53aWRnZXRzLXNvcnRhYmxlcycpLnNvcnRhYmxlKCdkaXNhYmxlJyk7XG5cbiAgICAkKCcjYXZhaWxhYmxlLXdpZGdldHMnKS5kcm9wcGFibGUoe1xuICAgICAgdG9sZXJhbmNlOiAncG9pbnRlcicsXG4gICAgICBhY2NlcHQ6IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgcmV0dXJuICQobykucGFyZW50KCkuYXR0cignaWQnKSAhPSAnd2lkZ2V0LWxpc3QnO1xuICAgICAgfSxcbiAgICAgIGRyb3A6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIHVpLmRyYWdnYWJsZS5hZGRDbGFzcygnZGVsZXRpbmcnKTtcbiAgICAgICAgJCgnI3JlbW92aW5nLXdpZGdldCcpLmhpZGUoKS5jaGlsZHJlbignc3BhbicpLmh0bWwoJycpO1xuICAgICAgfSxcbiAgICAgIG92ZXI6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIHVpLmRyYWdnYWJsZS5hZGRDbGFzcygnZGVsZXRpbmcnKTtcbiAgICAgICAgJCgnZGl2LndpZGdldC1wbGFjZWhvbGRlcicpLmhpZGUoKTtcblxuICAgICAgICBpZiAodWkuZHJhZ2dhYmxlLmhhc0NsYXNzKCd1aS1zb3J0YWJsZS1oZWxwZXInKSkge1xuICAgICAgICAgICQoJyNyZW1vdmluZy13aWRnZXQnKS5zaG93KCkuY2hpbGRyZW4oJ3NwYW4nKVxuICAgICAgICAgICAgLmh0bWwodWkuZHJhZ2dhYmxlLmZpbmQoJ2Rpdi53aWRnZXQtdGl0bGUnKS5jaGlsZHJlbignaDQnKS5odG1sKCkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb3V0OiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB1aS5kcmFnZ2FibGUucmVtb3ZlQ2xhc3MoJ2RlbGV0aW5nJyk7XG4gICAgICAgICQoJ2Rpdi53aWRnZXQtcGxhY2Vob2xkZXInKS5zaG93KCk7XG4gICAgICAgICQoJyNyZW1vdmluZy13aWRnZXQnKS5oaWRlKCkuY2hpbGRyZW4oJ3NwYW4nKS5odG1sKCcnKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG5cbiAgc2F2ZU9yZGVyOiBmdW5jdGlvbihzYikge1xuICAgIGlmIChzYikge1xuICAgICAgJCgnIycgKyBzYikuY2xvc2VzdCgnZGl2LndpZGdldHMtaG9sZGVyLXdyYXAnKS5maW5kKCdpbWcuYWpheC1mZWVkYmFjaycpLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XG4gICAgfVxuXG4gICAgdmFyIGEgPSB7XG4gICAgICBhY3Rpb246ICd3aWRnZXRzLW9yZGVyJyxcbiAgICAgIHdpZGdldEFyZWFzOiBbXSxcbiAgICB9O1xuXG4gICAgJCgnZGl2LndpZGdldHMtc29ydGFibGVzJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIGFbJ3dpZGdldEFyZWFzWycgKyAkKHRoaXMpLmF0dHIoJ2lkJykgKyAnXSddID0gJCh0aGlzKS5zb3J0YWJsZSgndG9BcnJheScpLmpvaW4oJywnKTtcbiAgICB9KTtcblxuICAgICQucG9zdChTSVRFX1VSTCArICcvYWpheC5waHAnLCBhLCBmdW5jdGlvbigpIHtcbiAgICAgICQoJy5hamF4LWZlZWRiYWNrIGltZycpLmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICB9KTtcbiAgfSxcblxuICBzYXZlOiBmdW5jdGlvbih3aWRnZXQsIGRlbCwgYW5pbWF0ZSwgb3JkZXIpIHtcbiAgICB2YXIgc2IgPSB3aWRnZXQuY2xvc2VzdCgnZGl2LndpZGdldHMtc29ydGFibGVzJykuYXR0cignaWQnKSwgZGF0YSA9IHdpZGdldC5maW5kKCdmb3JtJykuc2VyaWFsaXplKCksIGE7XG4gICAgd2lkZ2V0ID0gJCh3aWRnZXQpO1xuICAgICQoJy5hamF4LWZlZWRiYWNrIGltZycsIHdpZGdldCkuY3NzKCd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKTtcbiAgICAkKCcuYWpheC1mZWVkYmFjayBzcGFuJywgd2lkZ2V0KS5odG1sKCcnKTtcblxuICAgIGEgPSB7XG4gICAgICBhY3Rpb246ICdzYXZlLXdpZGdldCcsXG4gICAgICBhcmVhOiBzYixcbiAgICB9O1xuXG4gICAgaWYgKGRlbCkge1xuICAgICAgYVsnZGVsZXRlX3dpZGdldCddID0gMTtcbiAgICB9XG5cbiAgICBkYXRhICs9ICcmJyArICQucGFyYW0oYSk7XG5cbiAgICAkLnBvc3QoU0lURV9VUkwgKyAnL2FqYXgucGhwJywgZGF0YSwgZnVuY3Rpb24ocikge1xuICAgICAgdmFyIGlkO1xuXG4gICAgICBpZiAoZGVsKSB7XG4gICAgICAgIGlmIChhbmltYXRlKSB7XG4gICAgICAgICAgb3JkZXIgPSAwO1xuICAgICAgICAgIHdpZGdldC5zbGlkZVVwKCdmYXN0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgbWJwV2lkZ2V0cy5zYXZlT3JkZXIoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3aWRnZXQucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQoJy5hamF4LWZlZWRiYWNrIGltZycpLmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgaWYgKHIgJiYgci5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgJCgnLmFqYXgtZmVlZGJhY2sgc3BhbicsIHdpZGdldCkuaHRtbChyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG9yZGVyKSB7XG4gICAgICAgIG1icFdpZGdldHMuc2F2ZU9yZGVyKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgY2xvc2U6IGZ1bmN0aW9uKHdpZGdldCkge1xuICAgIHdpZGdldC5jaGlsZHJlbignLndpZGdldC1pbnNpZGUnKS5zbGlkZVVwKCdmYXN0Jyk7XG4gIH0sXG5cbiAgY29sbGFwc2U6IGZ1bmN0aW9uKGl0ZW1Ub0NvbGxhcHNlKSB7XG4gICAgdmFyIGMgPSAkKGl0ZW1Ub0NvbGxhcHNlKS5zaWJsaW5ncygnLndpZGdldHMtc29ydGFibGVzJyksXG4gICAgICBwID0gJChpdGVtVG9Db2xsYXBzZSkucGFyZW50KCk7XG4gICAgaWYgKCFwLmhhc0NsYXNzKCdjbG9zZWQnKSkge1xuICAgICAgYy5zb3J0YWJsZSgnZGlzYWJsZScpO1xuICAgICAgcC5hZGRDbGFzcygnY2xvc2VkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHAucmVtb3ZlQ2xhc3MoJ2Nsb3NlZCcpO1xuICAgICAgYy5zb3J0YWJsZSgnZW5hYmxlJykuc29ydGFibGUoJ3JlZnJlc2gnKTtcbiAgICB9XG4gIH1cbn07Il19
