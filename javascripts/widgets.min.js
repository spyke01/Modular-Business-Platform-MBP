require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({2:[function(require,module,exports){
"use strict";

var mbpWidgets = {
  init: function init() {
    var rem,
        widgetAreas = $('div.widgets-sortables');
    $('#widgets-rightCol').children('.ui-widget').children('.header').click(function () {
      mbpWidgets.collapse(this);
    });
    $('#widgets-rightCol').children('.box').children('.box-header').click(function () {
      mbpWidgets.collapse(this);
    });
    $('#available-widgets').children('.box-header').click(function () {
      mbpWidgets.collapse(this);
    });
    $(document).on('click', 'a.widget-action', function () {
      var css = {},
          widget = $(this).closest('div.widget'),
          inside = widget.children('.widget-inside');

      if (inside.is(':hidden')) {
        inside.slideDown('fast');
      } else {
        inside.slideUp('fast');
      }

      return false;
    });
    $(document).on('click', 'input.widget-control-save', function () {
      mbpWidgets.save($(this).closest('div.widget'), 0, 1, 0);
      return false;
    });
    $(document).on('click', 'a.widget-control-remove', function () {
      mbpWidgets.save($(this).closest('div.widget'), 1, 1, 0);
      return false;
    });
    $(document).on('click', 'a.widget-control-close', function () {
      mbpWidgets.close($(this).closest('div.widget'));
      return false;
    });
    widgetAreas.children('.widget').each(function () {
      if ($('p.widget-error', this).length) {
        $('a.widget-action', this).click();
      }
    });
    $('#widget-list').children('.widget').draggable({
      connectToSortable: 'div.widgets-sortables',
      handle: '> .widget-top > .widget-title',
      distance: 2,
      helper: 'clone',
      zIndex: 5,
      containment: 'document',
      start: function start(e, ui) {
        ui.helper.find('div.widget-description').hide();
      },
      stop: function stop(e, ui) {
        if (rem) {
          $(rem).hide();
        }

        rem = '';
      }
    });
    widgetAreas.sortable({
      placeholder: 'widget-placeholder',
      items: '> .widget',
      handle: '> .widget-top > .widget-title',
      cursor: 'move',
      distance: 2,
      containment: 'document',
      start: function start(e, ui) {
        ui.item.children('.widget-inside').hide();
      },
      stop: function stop(e, ui) {
        if (ui.item.hasClass('ui-draggable') && ui.item.data('draggable')) {
          ui.item.draggable('destroy');
        }

        if (ui.item.hasClass('deleting')) {
          mbpWidgets.save(ui.item, 1, 0, 1); // delete widget

          ui.item.remove();
          return;
        }

        var add = ui.item.find('input.create').val(),
            n = ui.item.find('input.instance_number').val(),
            id = ui.item.find('input.widget-id').val(),
            sb = $(this).attr('id');

        if (add) {
          ui.item.html(ui.item.html().replace(/<[^<>]+>/g, function (m) {
            return m.replace(/__i__|%i%/g, n);
          }));
          ui.item.attr('id', ui.item.find('input.widget-id').val()); // The id doesn't changed so pull the proper value from the hidden field

          n++;
          $('div#widget-' + id).find('input.instance_number').val(n); // This will set our next instance value

          mbpWidgets.save(ui.item, 0, 0, 1);
          ui.item.find('input.create').val('');
          ui.item.find('a.widget-action').click();
          return;
        }

        mbpWidgets.saveOrder(sb);
      },
      receive: function receive(e, ui) {
        if (!$(this).is(':visible')) {
          $(this).sortable('cancel');
        }
      }
    }).sortable('option', 'connectWith', 'div.widgets-sortables').parent().filter('.closed').children('.widgets-sortables').sortable('disable');
    $('#available-widgets').droppable({
      tolerance: 'pointer',
      accept: function accept(o) {
        return $(o).parent().attr('id') != 'widget-list';
      },
      drop: function drop(e, ui) {
        ui.draggable.addClass('deleting');
        $('#removing-widget').hide().children('span').html('');
      },
      over: function over(e, ui) {
        ui.draggable.addClass('deleting');
        $('div.widget-placeholder').hide();

        if (ui.draggable.hasClass('ui-sortable-helper')) {
          $('#removing-widget').show().children('span').html(ui.draggable.find('div.widget-title').children('h4').html());
        }
      },
      out: function out(e, ui) {
        ui.draggable.removeClass('deleting');
        $('div.widget-placeholder').show();
        $('#removing-widget').hide().children('span').html('');
      }
    });
  },
  saveOrder: function saveOrder(sb) {
    if (sb) {
      $('#' + sb).closest('div.widgets-holder-wrap').find('img.ajax-feedback').css('visibility', 'visible');
    }

    var a = {
      action: 'widgets-order',
      widgetAreas: []
    };
    $('div.widgets-sortables').each(function () {
      a['widgetAreas[' + $(this).attr('id') + ']'] = $(this).sortable('toArray').join(',');
    });
    $.post(SITE_URL + '/ajax.php', a, function () {
      $('.ajax-feedback img').css('visibility', 'hidden');
    });
  },
  save: function save(widget, del, animate, order) {
    var sb = widget.closest('div.widgets-sortables').attr('id'),
        data = widget.find('form').serialize(),
        a;
    widget = $(widget);
    $('.ajax-feedback img', widget).css('visibility', 'visible');
    $('.ajax-feedback span', widget).html('');
    a = {
      action: 'save-widget',
      area: sb
    };

    if (del) {
      a['delete_widget'] = 1;
    }

    data += '&' + $.param(a);
    $.post(SITE_URL + '/ajax.php', data, function (r) {
      var id;

      if (del) {
        if (animate) {
          order = 0;
          widget.slideUp('fast', function () {
            $(this).remove();
            mbpWidgets.saveOrder();
          });
        } else {
          widget.remove();
        }
      } else {
        $('.ajax-feedback img').css('visibility', 'hidden');

        if (r && r.length > 2) {
          $('.ajax-feedback span', widget).html(r);
        }
      }

      if (order) {
        mbpWidgets.saveOrder();
      }
    });
  },
  close: function close(widget) {
    widget.children('.widget-inside').slideUp('fast');
  },
  collapse: function collapse(itemToCollapse) {
    var c = $(itemToCollapse).siblings('.widgets-sortables'),
        p = $(itemToCollapse).parent();

    if (!p.hasClass('closed')) {
      c.sortable('disable');
      p.addClass('closed');
    } else {
      p.removeClass('closed');
      c.sortable('enable').sortable('refresh');
    }
  }
};

},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqYXZhc2NyaXB0c1xcd2lkZ2V0cy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBSSxVQUFVLEdBQUc7QUFDZixFQUFBLElBQUksRUFBRSxnQkFBVztBQUNmLFFBQUksR0FBSjtBQUFBLFFBQVMsV0FBVyxHQUFHLENBQUMsQ0FBQyx1QkFBRCxDQUF4QjtBQUVBLElBQUEsQ0FBQyxDQUFDLG1CQUFELENBQUQsQ0FBdUIsUUFBdkIsQ0FBZ0MsWUFBaEMsRUFBOEMsUUFBOUMsQ0FBdUQsU0FBdkQsRUFBa0UsS0FBbEUsQ0FBd0UsWUFBVztBQUNqRixNQUFBLFVBQVUsQ0FBQyxRQUFYLENBQW9CLElBQXBCO0FBQ0QsS0FGRDtBQUlBLElBQUEsQ0FBQyxDQUFDLG1CQUFELENBQUQsQ0FBdUIsUUFBdkIsQ0FBZ0MsTUFBaEMsRUFBd0MsUUFBeEMsQ0FBaUQsYUFBakQsRUFBZ0UsS0FBaEUsQ0FBc0UsWUFBVztBQUMvRSxNQUFBLFVBQVUsQ0FBQyxRQUFYLENBQW9CLElBQXBCO0FBQ0QsS0FGRDtBQUlBLElBQUEsQ0FBQyxDQUFDLG9CQUFELENBQUQsQ0FBd0IsUUFBeEIsQ0FBaUMsYUFBakMsRUFBZ0QsS0FBaEQsQ0FBc0QsWUFBVztBQUMvRCxNQUFBLFVBQVUsQ0FBQyxRQUFYLENBQW9CLElBQXBCO0FBQ0QsS0FGRDtBQUlBLElBQUEsQ0FBQyxDQUFDLFFBQUQsQ0FBRCxDQUFZLEVBQVosQ0FBZSxPQUFmLEVBQXdCLGlCQUF4QixFQUEyQyxZQUFXO0FBQ3BELFVBQUksR0FBRyxHQUFHLEVBQVY7QUFBQSxVQUFjLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBRCxDQUFELENBQVEsT0FBUixDQUFnQixZQUFoQixDQUF2QjtBQUFBLFVBQXNELE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUCxDQUFnQixnQkFBaEIsQ0FBL0Q7O0FBRUEsVUFBSSxNQUFNLENBQUMsRUFBUCxD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QWlDLElBQWpDLENBQXNDLENBQXRDO0FBQ0Q7QUFDRjs7QUFDRCxVQUFJLEtBQUosRUFBVztBQUNULFFBQUEsVUFBVSxDQUFDLFNBQVg7QUFDRDtBQUNGLEtBdEJEO0FBdUJELEdBck1jO0FBdU1mLEVBQUEsS0FBSyxFQUFFLGVBQVMsTUFBVCxFQUFpQjtBQUN0QixJQUFBLE1BQU0sQ0FBQyxRQUFQLENBQWdCLGdCQUFoQixFQUFrQyxPQUFsQyxDQUEwQyxNQUExQztBQUNELEdBek1jO0FBMk1mLEVBQUEsUUFBUSxFQUFFLGtCQUFTLGNBQVQsRUFBeUI7QUFDakMsUUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLGNBQUQsQ0FBRCxDQUFrQixRQUFsQixDQUEyQixvQkFBM0IsQ0FBUjtBQUFBLFFBQ0UsQ0FBQyxHQUFHLENBQUMsQ0FBQyxjQUFELENBQUQsQ0FBa0IsTUFBbEIsRUFETjs7QUFFQSxRQUFJLENBQUMsQ0FBQyxDQUFDLFFBQUYsQ0FBVyxRQUFYLENBQUwsRUFBMkI7QUFDekIsTUFBQSxDQUFDLENBQUMsUUFBRixDQUFXLFNBQVg7QUFDQSxNQUFBLENBQUMsQ0FBQyxRQUFGLENBQVcsUUFBWDtBQUNELEtBSEQsTUFHTztBQUNMLE1BQUEsQ0FBQyxDQUFDLFdBQUYsQ0FBYyxRQUFkO0FBQ0EsTUFBQSxDQUFDLENBQUMsUUFBRixDQUFXLFFBQVgsRUFBcUIsUUFBckIsQ0FBOEIsU0FBOUI7QUFDRDtBQUNGO0FBck5jLENBQWpCIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBtYnBXaWRnZXRzID0ge1xuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcmVtLCB3aWRnZXRBcmVhcyA9ICQoJ2Rpdi53aWRnZXRzLXNvcnRhYmxlcycpO1xuXG4gICAgJCgnI3dpZGdldHMtcmlnaHRDb2wnKS5jaGlsZHJlbignLnVpLXdpZGdldCcpLmNoaWxkcmVuKCcuaGVhZGVyJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICBtYnBXaWRnZXRzLmNvbGxhcHNlKHRoaXMpO1xuICAgIH0pO1xuXG4gICAgJCgnI3dpZGdldHMtcmlnaHRDb2wnKS5jaGlsZHJlbignLmJveCcpLmNoaWxkcmVuKCcuYm94LWhlYWRlcicpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgbWJwV2lkZ2V0cy5jb2xsYXBzZSh0aGlzKTtcbiAgICB9KTtcblxuICAgICQoJyNhdmFpbGFibGUtd2lkZ2V0cycpLmNoaWxkcmVuKCcuYm94LWhlYWRlcicpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgbWJwV2lkZ2V0cy5jb2xsYXBzZSh0aGlzKTtcbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdhLndpZGdldC1hY3Rpb24nLCBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjc3MgPSB7fSwgd2lkZ2V0ID0gJCh0aGlzKS5jbG9zZXN0KCdkaXYud2lkZ2V0JyksIGluc2lkZSA9IHdpZGdldC5jaGlsZHJlbignLndpZGdldC1pbnNpZGUnKTtcblxuICAgICAgaWYgKGluc2lkZS5pcygnOmhpZGRlbicpKSB7XG4gICAgICAgIGluc2lkZS5zbGlkZURvd24oJ2Zhc3QnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGluc2lkZS5zbGlkZVVwKCdmYXN0Jyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnaW5wdXQud2lkZ2V0LWNvbnRyb2wtc2F2ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgbWJwV2lkZ2V0cy5zYXZlKCQodGhpcykuY2xvc2VzdCgnZGl2LndpZGdldCcpLCAwLCAxLCAwKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdhLndpZGdldC1jb250cm9sLXJlbW92ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgbWJwV2lkZ2V0cy5zYXZlKCQodGhpcykuY2xvc2VzdCgnZGl2LndpZGdldCcpLCAxLCAxLCAwKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdhLndpZGdldC1jb250cm9sLWNsb3NlJywgZnVuY3Rpb24oKSB7XG4gICAgICBtYnBXaWRnZXRzLmNsb3NlKCQodGhpcykuY2xvc2VzdCgnZGl2LndpZGdldCcpKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIHdpZGdldEFyZWFzLmNoaWxkcmVuKCcud2lkZ2V0JykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIGlmICgkKCdwLndpZGdldC1lcnJvcicsIHRoaXMpLmxlbmd0aCkge1xuICAgICAgICAkKCdhLndpZGdldC1hY3Rpb24nLCB0aGlzKS5jbGljaygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCgnI3dpZGdldC1saXN0JykuY2hpbGRyZW4oJy53aWRnZXQnKS5kcmFnZ2FibGUoe1xuICAgICAgY29ubmVjdFRvU29ydGFibGU6ICdkaXYud2lkZ2V0cy1zb3J0YWJsZXMnLFxuICAgICAgaGFuZGxlOiAnPiAud2lkZ2V0LXRvcCA+IC53aWRnZXQtdGl0bGUnLFxuICAgICAgZGlzdGFuY2U6IDIsXG4gICAgICBoZWxwZXI6ICdjbG9uZScsXG4gICAgICB6SW5kZXg6IDUsXG4gICAgICBjb250YWlubWVudDogJ2RvY3VtZW50JyxcbiAgICAgIHN0YXJ0OiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB1aS5oZWxwZXIuZmluZCgnZGl2LndpZGdldC1kZXNjcmlwdGlvbicpLmhpZGUoKTtcbiAgICAgIH0sXG4gICAgICBzdG9wOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICBpZiAocmVtKSB7XG4gICAgICAgICAgJChyZW0pLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZW0gPSAnJztcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB3aWRnZXRBcmVhcy5zb3J0YWJsZSh7XG4gICAgICBwbGFjZWhvbGRlcjogJ3dpZGdldC1wbGFjZWhvbGRlcicsXG4gICAgICBpdGVtczogJz4gLndpZGdldCcsXG4gICAgICBoYW5kbGU6ICc+IC53aWRnZXQtdG9wID4gLndpZGdldC10aXRsZScsXG4gICAgICBjdXJzb3I6ICdtb3ZlJyxcbiAgICAgIGRpc3RhbmNlOiAyLFxuICAgICAgY29udGFpbm1lbnQ6ICdkb2N1bWVudCcsXG4gICAgICBzdGFydDogZnVuY3Rpb24oZSwgdWkpIHtcbiAgICAgICAgdWkuaXRlbS5jaGlsZHJlbignLndpZGdldC1pbnNpZGUnKS5oaWRlKCk7XG4gICAgICB9LFxuICAgICAgc3RvcDogZnVuY3Rpb24oZSwgdWkpIHtcbiAgICAgICAgaWYgKHVpLml0ZW0uaGFzQ2xhc3MoJ3VpLWRyYWdnYWJsZScpICYmIHVpLml0ZW0uZGF0YSgnZHJhZ2dhYmxlJykpIHtcbiAgICAgICAgICB1aS5pdGVtLmRyYWdnYWJsZSgnZGVzdHJveScpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVpLml0ZW0uaGFzQ2xhc3MoJ2RlbGV0aW5nJykpIHtcbiAgICAgICAgICBtYnBXaWRnZXRzLnNhdmUodWkuaXRlbSwgMSwgMCwgMSk7IC8vIGRlbGV0ZSB3aWRnZXRcbiAgICAgICAgICB1aS5pdGVtLnJlbW92ZSgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhZGQgPSB1aS5pdGVtLmZpbmQoJ2lucHV0LmNyZWF0ZScpLnZhbCgpLFxuICAgICAgICAgIG4gPSB1aS5pdGVtLmZpbmQoJ2lucHV0Lmluc3RhbmNlX251bWJlcicpLnZhbCgpLFxuICAgICAgICAgIGlkID0gdWkuaXRlbS5maW5kKCdpbnB1dC53aWRnZXQtaWQnKS52YWwoKSxcbiAgICAgICAgICBzYiA9ICQodGhpcykuYXR0cignaWQnKTtcblxuICAgICAgICBpZiAoYWRkKSB7XG4gICAgICAgICAgdWkuaXRlbS5odG1sKHVpLml0ZW0uaHRtbCgpLnJlcGxhY2UoLzxbXjw+XSs+L2csIGZ1bmN0aW9uKG0pIHsgcmV0dXJuIG0ucmVwbGFjZSgvX19pX198JWklL2csIG4pOyB9KSk7XG4gICAgICAgICAgdWkuaXRlbS5hdHRyKCdpZCcsIHVpLml0ZW0uZmluZCgnaW5wdXQud2lkZ2V0LWlkJykudmFsKCkpOyAvLyBUaGUgaWQgZG9lc24ndCBjaGFuZ2VkIHNvIHB1bGwgdGhlIHByb3BlciB2YWx1ZSBmcm9tIHRoZSBoaWRkZW4gZmllbGRcbiAgICAgICAgICBuKys7XG4gICAgICAgICAgJCgnZGl2I3dpZGdldC0nICsgaWQpLmZpbmQoJ2lucHV0Lmluc3RhbmNlX251bWJlcicpLnZhbChuKTsgLy8gVGhpcyB3aWxsIHNldCBvdXIgbmV4dCBpbnN0YW5jZSB2YWx1ZVxuXG4gICAgICAgICAgbWJwV2lkZ2V0cy5zYXZlKHVpLml0ZW0sIDAsIDAsIDEpO1xuICAgICAgICAgIHVpLml0ZW0uZmluZCgnaW5wdXQuY3JlYXRlJykudmFsKCcnKTtcbiAgICAgICAgICB1aS5pdGVtLmZpbmQoJ2Eud2lkZ2V0LWFjdGlvbicpLmNsaWNrKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIG1icFdpZGdldHMuc2F2ZU9yZGVyKHNiKTtcbiAgICAgIH0sXG4gICAgICByZWNlaXZlOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICBpZiAoISQodGhpcykuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAkKHRoaXMpLnNvcnRhYmxlKCdjYW5jZWwnKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KS5zb3J0YWJsZSgnb3B0aW9uJywgJ2Nvbm5lY3RXaXRoJywgJ2Rpdi53aWRnZXRzLXNvcnRhYmxlcycpLnBhcmVudCgpLmZpbHRlcignLmNsb3NlZCcpLmNoaWxkcmVuKCcud2lkZ2V0cy1zb3J0YWJsZXMnKS5zb3J0YWJsZSgnZGlzYWJsZScpO1xuXG4gICAgJCgnI2F2YWlsYWJsZS13aWRnZXRzJykuZHJvcHBhYmxlKHtcbiAgICAgIHRvbGVyYW5jZTogJ3BvaW50ZXInLFxuICAgICAgYWNjZXB0OiBmdW5jdGlvbihvKSB7XG4gICAgICAgIHJldHVybiAkKG8pLnBhcmVudCgpLmF0dHIoJ2lkJykgIT0gJ3dpZGdldC1saXN0JztcbiAgICAgIH0sXG4gICAgICBkcm9wOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB1aS5kcmFnZ2FibGUuYWRkQ2xhc3MoJ2RlbGV0aW5nJyk7XG4gICAgICAgICQoJyNyZW1vdmluZy13aWRnZXQnKS5oaWRlKCkuY2hpbGRyZW4oJ3NwYW4nKS5odG1sKCcnKTtcbiAgICAgIH0sXG4gICAgICBvdmVyOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB1aS5kcmFnZ2FibGUuYWRkQ2xhc3MoJ2RlbGV0aW5nJyk7XG4gICAgICAgICQoJ2Rpdi53aWRnZXQtcGxhY2Vob2xkZXInKS5oaWRlKCk7XG5cbiAgICAgICAgaWYgKHVpLmRyYWdnYWJsZS5oYXNDbGFzcygndWktc29ydGFibGUtaGVscGVyJykpIHtcbiAgICAgICAgICAkKCcjcmVtb3Zpbmctd2lkZ2V0Jykuc2hvdygpLmNoaWxkcmVuKCdzcGFuJylcbiAgICAgICAgICAgIC5odG1sKHVpLmRyYWdnYWJsZS5maW5kKCdkaXYud2lkZ2V0LXRpdGxlJykuY2hpbGRyZW4oJ2g0JykuaHRtbCgpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG91dDogZnVuY3Rpb24oZSwgdWkpIHtcbiAgICAgICAgdWkuZHJhZ2dhYmxlLnJlbW92ZUNsYXNzKCdkZWxldGluZycpO1xuICAgICAgICAkKCdkaXYud2lkZ2V0LXBsYWNlaG9sZGVyJykuc2hvdygpO1xuICAgICAgICAkKCcjcmVtb3Zpbmctd2lkZ2V0JykuaGlkZSgpLmNoaWxkcmVuKCdzcGFuJykuaHRtbCgnJyk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuXG4gIHNhdmVPcmRlcjogZnVuY3Rpb24oc2IpIHtcbiAgICBpZiAoc2IpIHtcbiAgICAgICQoJyMnICsgc2IpLmNsb3Nlc3QoJ2Rpdi53aWRnZXRzLWhvbGRlci13cmFwJykuZmluZCgnaW1nLmFqYXgtZmVlZGJhY2snKS5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuICAgIH1cblxuICAgIHZhciBhID0ge1xuICAgICAgYWN0aW9uOiAnd2lkZ2V0cy1vcmRlcicsXG4gICAgICB3aWRnZXRBcmVhczogW10sXG4gICAgfTtcblxuICAgICQoJ2Rpdi53aWRnZXRzLXNvcnRhYmxlcycpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICBhWyd3aWRnZXRBcmVhc1snICsgJCh0aGlzKS5hdHRyKCdpZCcpICsgJ10nXSA9ICQodGhpcykuc29ydGFibGUoJ3RvQXJyYXknKS5qb2luKCcsJyk7XG4gICAgfSk7XG5cbiAgICAkLnBvc3QoU0lURV9VUkwgKyAnL2FqYXgucGhwJywgYSwgZnVuY3Rpb24oKSB7XG4gICAgICAkKCcuYWpheC1mZWVkYmFjayBpbWcnKS5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgfSk7XG4gIH0sXG5cbiAgc2F2ZTogZnVuY3Rpb24od2lkZ2V0LCBkZWwsIGFuaW1hdGUsIG9yZGVyKSB7XG4gICAgdmFyIHNiID0gd2lkZ2V0LmNsb3Nlc3QoJ2Rpdi53aWRnZXRzLXNvcnRhYmxlcycpLmF0dHIoJ2lkJyksIGRhdGEgPSB3aWRnZXQuZmluZCgnZm9ybScpLnNlcmlhbGl6ZSgpLCBhO1xuICAgIHdpZGdldCA9ICQod2lkZ2V0KTtcbiAgICAkKCcuYWpheC1mZWVkYmFjayBpbWcnLCB3aWRnZXQpLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XG4gICAgJCgnLmFqYXgtZmVlZGJhY2sgc3BhbicsIHdpZGdldCkuaHRtbCgnJyk7XG5cbiAgICBhID0ge1xuICAgICAgYWN0aW9uOiAnc2F2ZS13aWRnZXQnLFxuICAgICAgYXJlYTogc2IsXG4gICAgfTtcblxuICAgIGlmIChkZWwpIHtcbiAgICAgIGFbJ2RlbGV0ZV93aWRnZXQnXSA9IDE7XG4gICAgfVxuXG4gICAgZGF0YSArPSAnJicgKyAkLnBhcmFtKGEpO1xuXG4gICAgJC5wb3N0KFNJVEVfVVJMICsgJy9hamF4LnBocCcsIGRhdGEsIGZ1bmN0aW9uKHIpIHtcbiAgICAgIHZhciBpZDtcblxuICAgICAgaWYgKGRlbCkge1xuICAgICAgICBpZiAoYW5pbWF0ZSkge1xuICAgICAgICAgIG9yZGVyID0gMDtcbiAgICAgICAgICB3aWRnZXQuc2xpZGVVcCgnZmFzdCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIG1icFdpZGdldHMuc2F2ZU9yZGVyKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgd2lkZ2V0LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkKCcuYWpheC1mZWVkYmFjayBpbWcnKS5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIGlmIChyICYmIHIubGVuZ3RoID4gMikge1xuICAgICAgICAgICQoJy5hamF4LWZlZWRiYWNrIHNwYW4nLCB3aWRnZXQpLmh0bWwocik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChvcmRlcikge1xuICAgICAgICBtYnBXaWRnZXRzLnNhdmVPcmRlcigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIGNsb3NlOiBmdW5jdGlvbih3aWRnZXQpIHtcbiAgICB3aWRnZXQuY2hpbGRyZW4oJy53aWRnZXQtaW5zaWRlJykuc2xpZGVVcCgnZmFzdCcpO1xuICB9LFxuXG4gIGNvbGxhcHNlOiBmdW5jdGlvbihpdGVtVG9Db2xsYXBzZSkge1xuICAgIHZhciBjID0gJChpdGVtVG9Db2xsYXBzZSkuc2libGluZ3MoJy53aWRnZXRzLXNvcnRhYmxlcycpLFxuICAgICAgcCA9ICQoaXRlbVRvQ29sbGFwc2UpLnBhcmVudCgpO1xuICAgIGlmICghcC5oYXNDbGFzcygnY2xvc2VkJykpIHtcbiAgICAgIGMuc29ydGFibGUoJ2Rpc2FibGUnKTtcbiAgICAgIHAuYWRkQ2xhc3MoJ2Nsb3NlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwLnJlbW92ZUNsYXNzKCdjbG9zZWQnKTtcbiAgICAgIGMuc29ydGFibGUoJ2VuYWJsZScpLnNvcnRhYmxlKCdyZWZyZXNoJyk7XG4gICAgfVxuICB9XG59OyJdfQ==
